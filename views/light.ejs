<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robot" content="index,follow" />
    <meta name="description" content="" />
    <meta name="author" content="yang" />
    <base target="_self" />
    <!--page icon goes here-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="shortcut icon" href="" />
    <link rel="bookmark" href="" />
    <title>宮廟</title>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">Navbar</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    </li>
                    <% if(user==null){%>
                        <!--非登入狀態顯示-->
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="/">首頁</a>
                        <li class="nav-item">
                            <a class="nav-link" href="/login">登入</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/register">註冊</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link " href="/light" onclick="alert('請先登入！')">光明燈</a>
                        </li>
                        <%}%>
                            <%if(user){%>
                                <!--登入狀態顯示-->
                                <li class="nav-item">
                                    <a class="nav-link active" aria-current="page" href="/homepage_login">首頁</a>
                                <li class="nav-item">
                                    <a id="logout" class="nav-link" href="/"
                                        onclick="if(confirm('你確定要登出嗎?')==false) return false;">登出</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link " href="/light">光明燈</a>
                                </li>
                                <% } %>

                                    <% if(user!=null && user.name=="god" ){ %>
                                        <!--如果是管理員的話顯示-->
                                        <li class="nav-item">
                                            <a class="nav-link " href="/administrator">會員管理系統</a>
                                        </li>
                                        <% } %>
                </ul>
            </div>
        </div>
    </nav>
    <div style="display:flex;flex-direction: column;justify-content: center;align-items: center;">
        <% if(!user.record.find((year)=>year== date.getFullYear()) && user.state == "無"){ %> 
            <div style="display:flex;flex-direction: column;justify-content: center;align-items: center;">
                <h1>您今年尚未申請光明燈</h1>
                <button>立即申請</button>
            </div>
        <% } %>
        <% if(user.state == "applying"){ %> 
            <div style="display:flex;flex-direction: column;justify-content: center;align-items: center;">
                <h1>光明燈已申請，正在處理中...</h1>
            </div>
        <% } %>
        <div class="text"style="display:flex;flex-direction: column;justify-content: center;align-items: center;">
            <h1>申請紀錄</h1>
        </div>
        <div style="display:flex;align-items: center;flex-wrap: wrap;padding-left: 3rem;">
            <% user.record.map((d)=>{ %>
                <div class="card"style="border-color:orange;border-width:1rem;margin:1rem;display:flex;flex-direction: column;justify-content: center;align-items: center;padding: 1rem;">
                    <img src="https://www.longshansi.org.tw/upload_files/web/uploadfile/2022020913/original/220209130837886152.svg" alt="光明燈照片" style="width: 250px; height: 250px;">
                    <div style="background-color: black;width: 80%;margin-bottom: 1rem;border-radius: 2rem;"><p style="text-align: center;color: white;margin: 8px;"><%= user.name %> </p></div>
                    <div style="background-color: black;width: 80%;border-radius: 2rem;"><p style="text-align: center;color: white;margin: 8px;"><%= d %> </p></div>
                </div> 
                <%})%>
        </div> 
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
    <script>
        const logout = document.getElementById("logout");
        //登出
        logout.addEventListener("click", () => {
            user = null;
        });
    </script>
</body>

</html>